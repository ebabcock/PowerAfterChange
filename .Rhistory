getSD_within_hat <- function(baseline,siteVar="site",responseVar="y"){
sd_within_hat <- baseline %>%
group_by(!!sym(siteVar)) %>%
summarise(sd_site = sd(!!sym(responseVar))) %>%
summarise(sd_within = mean(sd_site)) %>%
pull(sd_within)
return(sd_within_hat)
}
getSD_within_hat
getSD_within(baseline = ,"site","y")
getSD_within <- function(baseline,siteVar="site",responseVar="y"){
sd_within_hat <- baseline %>%
group_by(!!sym(siteVar)) %>%
summarise(sd_site = sd(!!sym(responseVar))) %>%
summarise(sd_within = mean(sd_site)) %>%
pull(sd_within)
return(sd_within_hat)
}
getSD_within(baseline = ,"site","y")
library(tidyverse)
getSD_within <- function(baseline,siteVar="site",responseVar="y"){
sd_within_hat <- baseline %>%
group_by(!!sym(siteVar)) %>%
summarise(sd_site = sd(!!sym(responseVar))) %>%
summarise(sd_within = mean(sd_site)) %>%
pull(sd_within)
return(sd_within_hat)
}
getSD_within(baseline = ,"site","y")
set.seed(123)
S_demo <- 12
mB_demo <- 5
sd_within <- 2
sd_between <- 1
before_mean <- 10
siteMean <- rnorm(S_demo, mean = before_mean, sd = sd_between)
baseline_demo <- data.frame(
site = rep(1:S_demo, each = mB_demo)) %>%
mutate(y = rnorm(S_demo * mB_demo, mean = siteMean[site], sd = sd_within))
sd_within_hat <-getSD_within(baseline = ,"site","y")
getSD_within <- function(baseline,siteVar="site",responseVar="y"){
sd_within_hat <- baseline %>%
group_by(!!sym(siteVar)) %>%
summarise(sd_site = sd(!!sym(responseVar))) %>%
summarise(sd_within = mean(sd_site)) %>%
pull(sd_within)
return(sd_within_hat)
}
baseline<-baseline_demo
siteVar="site"
responseVar="y"
sd_within_hat <- baseline %>%
group_by(!!sym(siteVar)) %>%
summarise(sd_site = sd(!!sym(responseVar))) %>%
summarise(sd_within = mean(sd_site)) %>%
pull(sd_within)
return(sd_within_hat)
sd_within_hat
getSD_within <- function(baseline,siteVar="site",responseVar="y"){
sd_within_hat <- baseline %>%
group_by(!!sym(siteVar)) %>%
summarise(sd_site = sd(!!sym(responseVar))) %>%
summarise(sd_within = mean(sd_site)) %>%
pull(sd_within)
return(sd_within_hat)
}
sd_within_hat <-getSD_within(baseline = ,"site","y")
sd_within_hat <-getSD_within(baseline = baseline_demo,"site","y")
sd_within_hat
delta_target <- 1
sd_delta <- 0.5
res_n_after <- find_n_after(S = S_demo, mB = mB_demo,
delta = delta_target,
sd_w = sd_within_hat, sd_d = sd_delta,
target_power = 0.8, alpha = 0.05,
n_grid = 1:40, nsim = 3000, seed = 99)
#' power_for_n_after
#'
#' @param S Number of sites
#' @param mB  Number of before measurements per site
#' @param nA Number of after measurements per site
#' @param delta Hypothesized mean change
#' @param sd_w Within-site standard deviation
#' @param sd_d Between-site standard deviation of true changes
#' @param alpha Significance level, defaults to 0.05
#' @param nsim Number of simulations to run
#' @param seed Random seed for reproducibility
#'
#' @returns Estimated power for the given number of after measurements
#' @export
#'
power_for_n_after <- function(S, mB, nA,
delta, sd_w, sd_d = 0,
alpha = 0.05, nsim = 2000, seed = 1) {
set.seed(seed)
pvals <- replicate(nsim, {
true_change <- rnorm(S, mean = delta, sd = sd_d)
yB <- matrix(rnorm(S * mB, mean = 0, sd = sd_w), nrow = S)
yA <- matrix(rnorm(S * nA, mean = true_change, sd = sd_w), nrow = S)
D <- rowMeans(yA) - rowMeans(yB)
t.test(D, mu = 0)$p.value
})
mean(pvals < alpha)
}
#' find_n_after
#'
#' @param S Number of sites
#' @param mB Number of before measurements per site
#' @param delta Hypothesized mean change
#' @param sd_w Within-site standard deviation
#' @param sd_d Between-site standard deviation of true changes
#' @param target_power Desired power level to achieve
#' @param alpha Significance level, defaults to 0.05
#' @param n_grid Grid of after measurements to evaluate
#' @param nsim Number of simulations to run
#' @param seed Random seed for reproducibility
#'
#' @returns A list containing the minimum number of after measurements needed to achieve the target power and a data frame of the power curve
#' @export
#'
#' @examples
find_n_after <- function(S, mB,
delta, sd_w, sd_d = 0,
target_power = 0.8,
alpha = 0.05,
n_grid = 1:50,
nsim = 2000, seed = 1) {
pow <- sapply(n_grid, function(nA) {
power_for_n_after(S = S, mB = mB, nA = nA,
delta = delta, sd_w = sd_w, sd_d = sd_d,
alpha = alpha, nsim = nsim, seed = seed)
})
out <- data.frame(n_after = n_grid, power = pow)
n_star <- out$n_after[which(out$power >= target_power)[1]]
list(n_star = n_star, curve = out)
}
# Function to estimate power for a given number of sites
#' power_for_sites
#'
#' @param S Number of sites
#' @param mB Number of before measurements per site
#' @param nA Number of after measurements per site
#' @param delta Hypothesized mean change
#' @param sd_w Within-site standard deviation
#' @param sd_d Between-site standard deviation of true changes
#' @param alpha Significance level, defaults to 0.05
#' @param nsim Number of simulations to run
#' @param seed Random seed for reproducibility
#'
#' @returns Estimated power for the given number of sites
#' @export
#'
#' @examples
power_for_sites <- function(S, mB, nA,
delta, sd_w, sd_d = 0,
alpha = 0.05, nsim = 2000, seed = 1) {
power_for_n_after(S = S, mB = mB, nA = nA,
delta = delta, sd_w = sd_w, sd_d = sd_d,
alpha = alpha, nsim = nsim, seed = seed)
}
#Function to find the minimum number of sites (S) needed to achieve target power
#' find_min_sites
#'
#' @param mB Number of before measurements per site
#' @param nA Number of after measurements per site
#' @param delta Hypothesized mean change
#' @param sd_w Within-site standard deviation
#' @param sd_d Between-site standard deviation of true changes
#' @param target_power Desired power level to achieve
#' @param alpha Significance level, defaults to 0.05
#' @param S_grid Grid of site numbers to evaluate
#' @param nsim Number of simulations to run
#' @param seed Random seed for reproducibility
#'
#' @returns A list containing the minimum number of sites needed to achieve the target power and a data frame of the power curve
#' @export
#'
#' @examples
find_min_sites <- function(mB, nA,
delta, sd_w, sd_d = 0,
target_power = 0.8,
alpha = 0.05,
S_grid = 2:50,
nsim = 2000, seed = 1) {
S_grid <- S_grid[S_grid >= 2]
pow <- sapply(S_grid, function(S) {
power_for_sites(S = S, mB = mB, nA = nA,
delta = delta, sd_w = sd_w, sd_d = sd_d,
alpha = alpha, nsim = nsim, seed = seed)
})
out <- data.frame(S = S_grid, power = pow)
S_star <- out$S[which(out$power >= target_power)[1]]
list(S_star = S_star, curve = out)
}
getSD_within <- function(baseline,siteVar="site",responseVar="y"){
sd_within_hat <- baseline %>%
group_by(!!sym(siteVar)) %>%
summarise(sd_site = sd(!!sym(responseVar))) %>%
summarise(sd_within = mean(sd_site)) %>%
pull(sd_within)
return(sd_within_hat)
}
res_n_after <- find_n_after(S = S_demo, mB = mB_demo,
delta = delta_target,
sd_w = sd_within_hat, sd_d = sd_delta,
target_power = 0.8, alpha = 0.05,
n_grid = 1:40, nsim = 3000, seed = 99)
res_n_after$n_star
head(res_n_after$curve)
# Plot power curve for number of samples after
ggplot(res_n_after$curve, aes(x = n_after, y = power)) +
geom_line() +
geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
geom_vline(xintercept = res$n_star, linetype = "dashed", color = "blue") +
labs(title = "Power Curve for Before-After Design",
x = "Number of After Samples per Site",
y = "Power")
res_n_after <- find_n_after(S = S_demo, mB = mB_demo,
delta = delta_target,
sd_w = sd_within_hat, sd_d = sd_delta,
target_power = 0.8, alpha = 0.05,
n_grid = 1:40, nsim = 3000, seed = 99)
res_n_after$n_star  #Number of after samples need for specified power
head(res_n_after$curve)
# Plot power curve for number of samples after
ggplot(res_n_after$curve, aes(x = n_after, y = power)) +
geom_line() +
geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
geom_vline(xintercept = res_n_after$n_star, linetype = "dashed", color = "blue") +
labs(title = "Power Curve for Before-After Design",
x = "Number of After Samples per Site",
y = "Power")
site_res <- find_min_sites(mB = mB_demo, nA = 5,
delta = delta_target,
sd_w = sd_within_hat, sd_d = sd_delta,
target_power = 0.8, alpha = 0.05,
S_grid = 2:40, nsim = 3000, seed = 42)
site_res <- find_min_sites(mB = mB_demo, nA = 5,
delta = delta_target,
sd_w = sd_within_hat, sd_d = sd_delta,
target_power = 0.8, alpha = 0.05,
S_grid = 2:40, nsim = 3000, seed = 42)
site_res$S_star
# Plot power curve for sites
ggplot(site_res$curve, aes(x = S, y = power)) +
geom_line() +
geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
geom_vline(xintercept = site_res$S_star, linetype = "dashed", color = "blue") +
labs(title = "Power Curve for Number of Sites, known before and after samples",
x = "Number of Sites",
y = "Power")
usethis::use_pkgdown()
devtools::check()
devtools::check()
#usethis::use_pkgdown()
devtools::check()
#usethis::use_pkgdown()
devtools::check()
#usethis::use_pkgdown()
devtools::check()
#usethis::use_pkgdown()
devtools::check()
rm(list=ls())
#usethis::use_pkgdown()
devtools::check()
#usethis::use_pkgdown()
devtools::check()
#usethis::use_pkgdown()
devtools::check()
devtools::load_all()
devtools::document()
devtools::build_readme()
pkgdown::build_site()
pkgdown::build_site()
#usethis::use_pkgdown()
devtools::check()
devtools::load_all()
devtools::document()
devtools::build_readme()
devtools::build_readme()
devtools::build_readme()
pkgdown::build_site()
#usethis::use_pkgdown()
devtools::check()
devtools::build_readme()
pkgdown::build_site()
pkgdown::build_site()
usethis::use_pkgdown()
#usethis::use_pkgdown()
devtools::check()
#usethis::use_pkgdown()
use_mit_license()
#usethis::use_pkgdown()
pkgdown::use_mit_license()
#usethis::use_pkgdown()
devtools::::use_mit_license()
#usethis::use_pkgdown()
devtools::use_mit_license()
#usethis::use_pkgdown()
devtools::check()
#usethis::use_pkgdown()
devtools::check()
pkgdown::build_site()
#usethis::use_pkgdown()
devtools::check()
devtools::load_all()
devtools::document()
devtools::build_readme()
pkgdown::build_site()
pkgdown::build_site()
knitr::opts_chunk$set(eval=TRUE)
#devtools::install_github("ebabcock/PowerAfterChange")
library(PowerAfterChange)
set.seed(123)
S_demo <- 12
mB_demo <- 5
sd_within <- 2
sd_between <- 1
before_mean <- 10
#simulate site to site variability
siteMean <- rnorm(S_demo, mean = before_mean, sd = sd_between)
#Genarate baseline data (before change)
baseline_demo <- data.frame(
site = rep(1:S_demo, each = mB_demo)) %>%
mutate(y = rnorm(S_demo * mB_demo, mean = siteMean[site], sd = sd_within))
library(tidyverse)
#devtools::install_github("ebabcock/PowerAfterChange")
library(PowerAfterChange)
set.seed(123)
S_demo <- 12
mB_demo <- 5
sd_within <- 2
sd_between <- 1
before_mean <- 10
#simulate site to site variability
siteMean <- rnorm(S_demo, mean = before_mean, sd = sd_between)
#Genarate baseline data (before change)
baseline_demo <- data.frame(
site = rep(1:S_demo, each = mB_demo)) %>%
mutate(y = rnorm(S_demo * mB_demo, mean = siteMean[site], sd = sd_within))
sd_within_hat <-getSD_within(baseline = baseline_demo,"site","y")
sd_within_hat
delta_target <- 1
sd_delta <- 0.5
rm(list=ls())
#devtools::install_github("ebabcock/PowerAfterChange")
library(PowerAfterChange)
library(tidyverse)
#devtools::install_github("ebabcock/PowerAfterChange")
library(PowerAfterChange)
set.seed(123)
S_demo <- 12
mB_demo <- 5
sd_within <- 2
sd_between <- 1
before_mean <- 10
#simulate site to site variability
siteMean <- rnorm(S_demo, mean = before_mean, sd = sd_between)
#Genarate baseline data (before change)
baseline_demo <- data.frame(
site = rep(1:S_demo, each = mB_demo)) %>%
mutate(y = rnorm(S_demo * mB_demo, mean = siteMean[site], sd = sd_within))
sd_within_hat <-getSD_within(baseline = baseline_demo,"site","y")
sd_within_hat
rm(list=ls())
sd_within_hat <-getSD_within(baseline = baseline_demo,
siteVar = "site",
responseVar = "y")
knitr::opts_chunk$set(eval=TRUE)
library(tidyverse)
#devtools::install_github("ebabcock/PowerAfterChange")
library(PowerAfterChange)
set.seed(123)
S_demo <- 12
mB_demo <- 5
sd_within <- 2
sd_between <- 1
before_mean <- 10
#simulate site to site variability
siteMean <- rnorm(S_demo, mean = before_mean, sd = sd_between)
#Genarate baseline data (before change)
baseline_demo <- data.frame(
site = rep(1:S_demo, each = mB_demo)) %>%
mutate(y = rnorm(S_demo * mB_demo, mean = siteMean[site], sd = sd_within))
sd_within_hat <-getSD_within(baseline = baseline_demo,
siteVar = "site",
responseVar = "y")
sd_within_hat
knitr::opts_chunk$set(eval=TRUE)
library(tidyverse)
#devtools::install_github("ebabcock/PowerAfterChange")
library(PowerAfterChange)
set.seed(123)
S_demo <- 12
mB_demo <- 5
sd_within <- 2
sd_between <- 1
before_mean <- 10
#simulate site to site variability
siteMean <- rnorm(S_demo, mean = before_mean, sd = sd_between)
#Genarate baseline data (before change)
baseline_demo <- data.frame(
site = rep(1:S_demo, each = mB_demo)) %>%
mutate(y = rnorm(S_demo * mB_demo, mean = siteMean[site], sd = sd_within))
sd_within_hat <-getSD_within(baseline = baseline_demo,
siteVar = "site",
responseVar = "y")
sd_within_hat
delta_target <- 1
sd_delta <- 0.5
res_n_after <- find_n_after(S = S_demo, mB = mB_demo,
delta = delta_target,
sd_w = sd_within_hat, sd_d = sd_delta,
target_power = 0.8, alpha = 0.05,
n_grid = 1:40, nsim = 3000, seed = 99)
res_n_after$n_star  #Number of after samples need for specified power
head(res_n_after$curve)
# Plot power curve for number of samples after
ggplot(res_n_after$curve, aes(x = n_after, y = power)) +
geom_line() +
geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
geom_vline(xintercept = res_n_after$n_star, linetype = "dashed", color = "blue") +
labs(title = "Power Curve for Before-After Design",
x = "Number of After Samples per Site",
y = "Power")
site_res <- find_min_sites(mB = mB_demo, nA = 5,
delta = delta_target,
sd_w = sd_within_hat, sd_d = sd_delta,
target_power = 0.8, alpha = 0.05,
S_grid = 2:40, nsim = 3000, seed = 42)
site_res$S_star
# Plot power curve for sites
ggplot(site_res$curve, aes(x = S, y = power)) +
geom_line() +
geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
geom_vline(xintercept = site_res$S_star, linetype = "dashed", color = "blue") +
labs(title = "Power Curve for Number of Sites, known before and after samples",
x = "Number of Sites",
y = "Power")
devtools::install_github("ebabcock/PowerAfterChange")
#usethis::use_pkgdown()
devtools::check()
devtools::load_all()
devtools::document()
devtools::build_readme()
pkgdown::build_site()
devtools::install_github("ebabcock/PowerAfterChange")
library(PowerAfterChange)
?getSD_within
devtools::document()
devtools::install_github("ebabcock/PowerAfterChange")
getSD_within
library(PowerAfterChange)
getSD_within()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
vignette(pkgdown::metadata)
pkgdown::build_site()
