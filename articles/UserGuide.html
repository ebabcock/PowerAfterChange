<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>User guide for power after change • PowerAfterChange</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="User guide for power after change">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PowerAfterChange</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/UserGuide.html">User guide for power after change</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>User guide for power after change</h1>
                        <h4 data-toc-skip class="author">Beth
Babcock</h4>
            
            <h4 data-toc-skip class="date">2026-02-22</h4>
      

      <div class="d-none name"><code>UserGuide.Rmd</code></div>
    </div>

    
    
<p>These functions calculate power and sample size for a Before-After
t-test with fixed sites, repeated samples per site. Possible questions
to ask are:</p>
<ol style="list-style-type: decimal">
<li><p>Given a fixed number of samples per site before and after, and an
assumed effect size and variances, (a) how many sites are needed to
achieve target power? and (b) what is the power for a given number of
sites? This asks how increasing the number of sites would change the
ability to detect a future change, after some time has passed to
establish a baseline at the new sites.</p></li>
<li><p>Given a fixed number of sites, samples per site before, and an
assumed effect size and variances, (a) how many samples per site after
are needed to achieve target power? or (b) what is the power for a given
number of samples per site after? This addresses how long we would have
to wait after a change (e.g. a restoration action) to see the change
with, for example, annual samples.</p></li>
</ol>
<p>Functions are based on Monte Carlo simulation of normal data and
using the power.t.test function, to show that they are equivalent.</p>
<p>The functions were generated with the help of ChatGPT and GitHub
Copilot (various AI tools) 1/30/2026-2/5/2026.</p>
<p>The following is a simulated data demo. The simulated data is data
before the change, and we use this data to get an estimate of the
within-site standard deviation needed for planning. The data are
simulated with site-to-site variability and within-site variability,
using a normal distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#devtools::install_github("ebabcock/PowerAfterChange")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ebabcock.github.io/PowerAfterChange/">PowerAfterChange</a></span><span class="op">)</span> <span class="co">#Library with all the new functions</span></span></code></pre></div>
<div class="section level3">
<h3 id="simulate-some-data">Simulate some data<a class="anchor" aria-label="anchor" href="#simulate-some-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co">#for reproducibility</span></span>
<span><span class="va">S_demo</span> <span class="op">&lt;-</span> <span class="fl">12</span> <span class="co">#Number of sites</span></span>
<span><span class="va">nB_demo</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co">#Number of before samples per site</span></span>
<span><span class="va">sd_within</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co">#within-site standard deviation</span></span>
<span><span class="va">sd_between</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co">#between-site standard deviation</span></span>
<span><span class="va">before_mean</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co">#overall mean before change</span></span>
<span><span class="co">#simulate site to site variability</span></span>
<span><span class="va">siteMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">S_demo</span>, mean <span class="op">=</span> <span class="va">before_mean</span>, sd <span class="op">=</span> <span class="va">sd_between</span><span class="op">)</span></span>
<span><span class="co">#Generate baseline data (before change)</span></span>
<span><span class="va">baseline_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">S_demo</span>, each <span class="op">=</span> <span class="va">nB_demo</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">S_demo</span> <span class="op">*</span> <span class="va">nB_demo</span>, mean <span class="op">=</span> <span class="va">siteMean</span><span class="op">[</span><span class="va">site</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sd_within</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate-within-site-sd">Estimate within-site SD<a class="anchor" aria-label="anchor" href="#estimate-within-site-sd"></a>
</h3>
<p>We need the within-site standard deviation for the power and sample
size calculations. Here we estimate it from the baseline data. See
getSD_within function in PowerAfterFunctions for the code.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd_within_hat</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/getSD_within.html">getSD_within</a></span><span class="op">(</span>baseline <span class="op">=</span> <span class="va">baseline_demo</span>,</span>
<span>                             siteVar <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>                             responseVar <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">sd_within_hat</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.671255</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="planning-assumptions">Planning assumptions<a class="anchor" aria-label="anchor" href="#planning-assumptions"></a>
</h3>
<p>This is the change we want to be able to detect with sufficient
power.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta_target</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co">#change in the mean we want to detect</span></span>
<span><span class="va">sd_delta</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>  <span class="co">#variability in true changes among sites</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="question-1-find-minimum-sites-given-before-and-after-number-known-sample-size">(Question 1) Find minimum sites given before and after number known
sample size<a class="anchor" aria-label="anchor" href="#question-1-find-minimum-sites-given-before-and-after-number-known-sample-size"></a>
</h3>
<p>In this scenario, we know how many samples we have before and after
the change, and want to know how many sites are needed to achieve target
power. This is equivalent to a paired t-test power calculation, and we
will do it with both a simulation function and power.t.test to show they
are equivalent when we calculate the standard deviation of the
difference correctly.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_min_sites.html">find_min_sites</a></span><span class="op">(</span>nB <span class="op">=</span> <span class="va">nB_demo</span>, nA <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                           delta <span class="op">=</span> <span class="va">delta_target</span>,</span>
<span>                           sd_w <span class="op">=</span> <span class="va">sd_within_hat</span>, sd_d <span class="op">=</span> <span class="va">sd_delta</span>,</span>
<span>                           target_power <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                           S_grid <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">40</span>, nsim <span class="op">=</span> <span class="fl">3000</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">site_res</span><span class="op">$</span><span class="va">S_star</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 13</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot power curve for sites</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">site_res</span><span class="op">$</span><span class="va">curve</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">S</span>, y <span class="op">=</span> <span class="va">power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">site_res</span><span class="op">$</span><span class="va">S_star</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Power Curve for Number of Sites, known before and after samples"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Number of Sites"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span></code></pre></div>
<p><img src="UserGuide_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="700"></p>
<p>The power curve shows how power increases with more samples after the
change. The dashed red line indicates the target power (0.8), and the
dashed blue line indicates the minimum number of after samples needed to
achieve that power.</p>
<p>Now, we repeat the calculation using the standard power.t.test
function for comparison.</p>
<p>The standard deviation of the difference between after and before
means per site is calculated as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi></mrow></msub><mo>=</mo><msqrt><mrow><mo stretchy="false" form="prefix">(</mo><mi>s</mi><msubsup><mi>d</mi><mi>w</mi><mn>2</mn></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>/</mi><msub><mi>n</mi><mi>A</mi></msub><mo>+</mo><mn>1</mn><mi>/</mi><msub><mi>n</mi><mi>B</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>s</mi><msubsup><mi>d</mi><mi>d</mi><mn>2</mn></msubsup></mrow></msqrt><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">s_{dif}=\sqrt{(sd_w^2(1/n_A + 1/n_B) + sd_d^2})</annotation></semantics></math></p>
<p>This combines: - Within-site variance for after measurements:
sd_w^2/nA - Within-site variance for before measurements: sd_w^2/nB -
Between-site variance in true changes: sd_d^2</p>
<p>The function getSD_difference makes this calculation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd_diff_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSD_difference.html">getSD_difference</a></span><span class="op">(</span>sd_within <span class="op">=</span> <span class="va">sd_within_hat</span>,</span>
<span>                                 nA <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                 nB <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                 sd_delta <span class="op">=</span> <span class="va">sd_delta</span><span class="op">)</span></span>
<span><span class="va">sd_diff_hat</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.169289</span></span></code></pre>
<p>We can then use power.t.test to find the number of sites needed for
the paired t-test.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                              delta <span class="op">=</span> <span class="va">delta_target</span>,</span>
<span>                              sd <span class="op">=</span> <span class="va">sd_diff_hat</span>,</span>
<span>                              sig.level <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                              power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                              type <span class="op">=</span> <span class="st">"paired"</span>,</span>
<span>                              alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span></span>
<span><span class="va">power_result</span><span class="op">$</span><span class="va">n</span>  <span class="co">#Number of sites needed</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 12.78393</span></span></code></pre>
<p>This matches the result from our simulation function find_min_sites.
Here is the power curve.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  n_sites <span class="op">=</span> <span class="va">site_res</span><span class="op">$</span><span class="va">curve</span><span class="op">$</span><span class="va">S</span>,</span>
<span>  power_analytical <span class="op">=</span> <span class="fu"><a href="../reference/find_min_sites_analytical.html">find_min_sites_analytical</a></span><span class="op">(</span>S_grid <span class="op">=</span> <span class="va">site_res</span><span class="op">$</span><span class="va">curve</span><span class="op">$</span><span class="va">S</span>,</span>
<span>                                                     delta_target <span class="op">=</span> <span class="va">delta_target</span>,</span>
<span>                                                     sd_diff <span class="op">=</span> <span class="va">sd_diff_hat</span><span class="op">)</span>,</span>
<span>  power_simulation <span class="op">=</span> <span class="va">site_res</span><span class="op">$</span><span class="va">curve</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot comparison</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comparison_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_sites</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">power_analytical</span>, color <span class="op">=</span> <span class="st">"power.t.test"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">power_simulation</span>, color <span class="op">=</span> <span class="st">"Simulation"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">power_result</span><span class="op">$</span><span class="va">n</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">site_res</span><span class="op">$</span><span class="va">S_star</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison: power.t.test vs Simulation-Based Power"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"power.t.test: n="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">power_result</span><span class="op">$</span><span class="va">n</span><span class="op">)</span>, </span>
<span>                      <span class="st">" | Simulation: n="</span>, <span class="va">site_res</span><span class="op">$</span><span class="va">S_star</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of Sites"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Power"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"power.t.test"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"Simulation"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="UserGuide_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="question-2-find-minimum-n_after">(Question 2) Find minimum n_after<a class="anchor" aria-label="anchor" href="#question-2-find-minimum-n_after"></a>
</h3>
<p>In this scenario, we have a fixed number of sites and samples before
the change, and want to know how many samples after the change are
needed to achieve target power.The function res_n_after finds the
minimum number of samples after the change needed to achieve target
power, given the number of sites and samples before the change.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_n_after</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_n_after.html">find_n_after</a></span><span class="op">(</span>S <span class="op">=</span> <span class="va">S_demo</span>, nB <span class="op">=</span> <span class="va">nB_demo</span>,</span>
<span>                    delta <span class="op">=</span> <span class="va">delta_target</span>,</span>
<span>                    sd_w <span class="op">=</span> <span class="va">sd_within_hat</span>, sd_d <span class="op">=</span> <span class="va">sd_delta</span>,</span>
<span>                    target_power <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    n_grid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span>, nsim <span class="op">=</span> <span class="fl">3000</span>, seed <span class="op">=</span> <span class="fl">99</span><span class="op">)</span></span>
<span><span class="va">res_n_after</span><span class="op">$</span><span class="va">n_star</span>  <span class="co">#Number of after samples need for specified power</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_n_after</span><span class="op">$</span><span class="va">curve</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   n_after     power</span></span>
<span><span class="co">## 1       1 0.3646667</span></span>
<span><span class="co">## 2       2 0.5600000</span></span>
<span><span class="co">## 3       3 0.6833333</span></span>
<span><span class="co">## 4       4 0.7100000</span></span>
<span><span class="co">## 5       5 0.7620000</span></span>
<span><span class="co">## 6       6 0.8070000</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot power curve for number of samples after</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">res_n_after</span><span class="op">$</span><span class="va">curve</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_after</span>, y <span class="op">=</span> <span class="va">power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">res_n_after</span><span class="op">$</span><span class="va">n_star</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Power Curve for Before-After Design"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Number of After Samples per Site"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="UserGuide_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="700">
The power curve shows how power increases with more samples after the
change. The dashed red line indicates the target power (0.8), and the
dashed blue line indicates the minimum number of after samples needed to
achieve that power.</p>
<p>Now, we repeat the calculation using the standard power.t.test
function for comparison. The standard deviation of the difference
between after and before means per site is calculated as before.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate power for a range of nA values</span></span>
<span><span class="va">nA_grid</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span></span>
<span><span class="va">power_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nA_grid</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nA</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/power_for_nA.html">power_for_nA</a></span><span class="op">(</span><span class="va">nA</span>, S <span class="op">=</span> <span class="va">S_demo</span>, nB <span class="op">=</span> <span class="va">nB_demo</span>, </span>
<span>               delta <span class="op">=</span> <span class="va">delta_target</span>,</span>
<span>                sd_within <span class="op">=</span> <span class="va">sd_within_hat</span>,</span>
<span>                sd_delta <span class="op">=</span> <span class="va">sd_delta</span>,</span>
<span>                alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Create a data frame for plotting</span></span>
<span><span class="va">comparison_nA_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  n_after <span class="op">=</span> <span class="va">nA_grid</span>,</span>
<span>  power_analytical <span class="op">=</span> <span class="va">power_values</span>,</span>
<span>  power_simulation <span class="op">=</span> <span class="va">res_n_after</span><span class="op">$</span><span class="va">curve</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot comparison</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comparison_nA_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_after</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">power_analytical</span>, color <span class="op">=</span> <span class="st">"power.t.test"</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">power_simulation</span>, color <span class="op">=</span> <span class="st">"Simulation"</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">res_n_after</span><span class="op">$</span><span class="va">n_star</span><span class="op">)</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison: power.t.test vs Simulation-Based Power"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"power.t.test: nA="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">res_n_after</span><span class="op">$</span><span class="va">n_star</span></span>
<span>    <span class="op">)</span>, <span class="st">" | Simulation: nA="</span>, <span class="va">res_n_after</span><span class="op">$</span><span class="va">n_star</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of After Samples per Site"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Power"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"power.t.test"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                <span class="st">"Simulation"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="UserGuide_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="700"></p>
<p>This matches the result from our simulation function
find_n_after.</p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>The simulation-based functions produce results that align closely
with the analytical solutions from power.t.test when the standard
deviation of the difference is calculated correctly. This validates the
simulation approach for power and sample size calculations in
Before-After designs with fixed sites and repeated samples per site. We
can now add biological realism by using functions other than normal for
the simulation, and adding more complex designs.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Elizabeth A Babcock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
