<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>User guide for power after change â€¢ PowerAfterChange</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="User guide for power after change">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PowerAfterChange</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/UserGuide.html">User guide for power after change</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>User guide for power after change</h1>
                        <h4 data-toc-skip class="author">Beth
Babcock</h4>
            
            <h4 data-toc-skip class="date">2026-02-05</h4>
      

      <div class="d-none name"><code>UserGuide.Rmd</code></div>
    </div>

    
    
<p>These functions calculate power and sample size for a Before-After
t-test with fixed sites, repeated samples per site. Possible questions
to ask are:</p>
<ol style="list-style-type: decimal">
<li><p>Given a fixed number of sites, samples per site before, and an
assumed effect size and variances, (a) how many samples per site after
are needed to achieve target power? or (b) what is the power for a given
number of samples per site after?</p></li>
<li><p>Given a fixed number of samples per site before and after, and an
assumed effect size and variances, (a) how many sites are needed to
achieve target power? and (b) what is the power for a given number of
sites?</p></li>
</ol>
<p>Functions are based on Monte Carlo simulation of normal data.</p>
<p>The functions were generated with the help of ChatGPT and GitHub
Copilot, 1/30/2026-2/4/2026.</p>
<p>The following is a simulated data demo.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#devtools::install_github("ebabcock/PowerAfterChange")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ebabcock.github.io/PowerAfterChange/">PowerAfterChange</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="simulate-some-data">Simulate some data<a class="anchor" aria-label="anchor" href="#simulate-some-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">S_demo</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">mB_demo</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">sd_within</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">sd_between</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">before_mean</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co">#simulate site to site variability</span></span>
<span><span class="va">siteMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">S_demo</span>, mean <span class="op">=</span> <span class="va">before_mean</span>, sd <span class="op">=</span> <span class="va">sd_between</span><span class="op">)</span></span>
<span><span class="co">#Genarate baseline data (before change)</span></span>
<span><span class="va">baseline_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">S_demo</span>, each <span class="op">=</span> <span class="va">mB_demo</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">S_demo</span> <span class="op">*</span> <span class="va">mB_demo</span>, mean <span class="op">=</span> <span class="va">siteMean</span><span class="op">[</span><span class="va">site</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sd_within</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="estimate-within-site-sd">Estimate within-site SD<a class="anchor" aria-label="anchor" href="#estimate-within-site-sd"></a>
</h4>
<p>We need the within-site standard deviation to plan the study. Here we
estimate it from the baseline data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd_within_hat</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/getSD_within.html">getSD_within</a></span><span class="op">(</span>baseline <span class="op">=</span> <span class="va">baseline_demo</span>,</span>
<span>                             siteVar <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>                             responseVar <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">sd_within_hat</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.671255</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="planning-assumptions">Planning assumptions<a class="anchor" aria-label="anchor" href="#planning-assumptions"></a>
</h4>
<p>This is the change we want to be able to detect with sufficient
power.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta_target</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">sd_delta</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="find-minimum-n_after">Find minimum n_after<a class="anchor" aria-label="anchor" href="#find-minimum-n_after"></a>
</h4>
<p>This function finds the minimum number of samples after the change
needed to achieve target power, given the number of sites and samples
before the change. If we have annual samples, for example, this is the
number of years we would need to sample after the change.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_n_after</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_n_after.html">find_n_after</a></span><span class="op">(</span>S <span class="op">=</span> <span class="va">S_demo</span>, mB <span class="op">=</span> <span class="va">mB_demo</span>,</span>
<span>                    delta <span class="op">=</span> <span class="va">delta_target</span>,</span>
<span>                    sd_w <span class="op">=</span> <span class="va">sd_within_hat</span>, sd_d <span class="op">=</span> <span class="va">sd_delta</span>,</span>
<span>                    target_power <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    n_grid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span>, nsim <span class="op">=</span> <span class="fl">3000</span>, seed <span class="op">=</span> <span class="fl">99</span><span class="op">)</span></span>
<span><span class="va">res_n_after</span><span class="op">$</span><span class="va">n_star</span>  <span class="co">#Number of after samples need for specified power</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_n_after</span><span class="op">$</span><span class="va">curve</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   n_after     power</span></span>
<span><span class="co">## 1       1 0.3646667</span></span>
<span><span class="co">## 2       2 0.5600000</span></span>
<span><span class="co">## 3       3 0.6833333</span></span>
<span><span class="co">## 4       4 0.7100000</span></span>
<span><span class="co">## 5       5 0.7620000</span></span>
<span><span class="co">## 6       6 0.8070000</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot power curve for number of samples after</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">res_n_after</span><span class="op">$</span><span class="va">curve</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_after</span>, y <span class="op">=</span> <span class="va">power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">res_n_after</span><span class="op">$</span><span class="va">n_star</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Power Curve for Before-After Design"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Number of After Samples per Site"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="UserGuide_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level4">
<h4 id="find-minimum-sites-given-before-and-after-number-known-sample-size">Find minimum sites given before and after number known sample
size<a class="anchor" aria-label="anchor" href="#find-minimum-sites-given-before-and-after-number-known-sample-size"></a>
</h4>
<p>In this scenario, we know how many samples we can take before and
after the change, and want to know how many sites are needed to achieve
target power.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_min_sites.html">find_min_sites</a></span><span class="op">(</span>mB <span class="op">=</span> <span class="va">mB_demo</span>, nA <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                           delta <span class="op">=</span> <span class="va">delta_target</span>,</span>
<span>                           sd_w <span class="op">=</span> <span class="va">sd_within_hat</span>, sd_d <span class="op">=</span> <span class="va">sd_delta</span>,</span>
<span>                           target_power <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                           S_grid <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">40</span>, nsim <span class="op">=</span> <span class="fl">3000</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">site_res</span><span class="op">$</span><span class="va">S_star</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 13</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot power curve for sites</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">site_res</span><span class="op">$</span><span class="va">curve</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">S</span>, y <span class="op">=</span> <span class="va">power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">site_res</span><span class="op">$</span><span class="va">S_star</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Power Curve for Number of Sites, known before and after samples"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Number of Sites"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span></code></pre></div>
<p><img src="UserGuide_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Elizabeth A Babcock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
